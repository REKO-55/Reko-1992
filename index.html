<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REKO V16 - DEVICE LOCK SYSTEM</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --gold: #D4AF37; --neon: #00FF00; --bg: #000; --red: #ff4444; }
        body { background-color: var(--bg); color: var(--neon); font-family: 'Cairo', sans-serif; text-align: center; margin: 0; padding: 10px; }
        .dev-header { background: #111; border-bottom: 3px solid var(--gold); padding: 15px; box-shadow: 0 0 20px var(--gold); }
        .dev-name { color: var(--gold); font-size: 24px; font-weight: bold; }
        .box { border: 2px solid var(--gold); padding: 20px; border-radius: 20px; background: #050505; max-width: 450px; margin: 15px auto; }
        input { padding: 15px; width: 85%; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #111; color: var(--gold); text-align: center; }
        .btn-main { background: var(--gold); color: #000; padding: 15px; width: 90%; border-radius: 12px; font-weight: bold; border: none; cursor: pointer; }
        .hidden { display: none; }
        .timer-badge { background: var(--red); color: #fff; padding: 5px 10px; border-radius: 50px; font-size: 12px; margin-bottom: 10px; display: inline-block; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .game-btn { background: #1a1a1a; color: #fff; padding: 15px; border-radius: 12px; border: 1px solid #333; font-size: 20px; }
        .res-display { background: #000; border: 1px solid var(--neon); padding: 20px; border-radius: 15px; font-size: 22px; margin: 15px 0; color: #fff; }
    </style>
</head>
<body>

    <div class="dev-header">
        <div class="dev-name">ðŸ‘‘ Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø±ÙŠÙƒÙˆ Ø¨Ø±ÙŠØ¯ÙŠØªÙˆØ± ðŸ‘‘</div>
    </div>

    <div id="loginGate" class="box">
        <h2 style="color: var(--gold);">Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© VIP</h2>
        <input type="text" id="authKey" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ">
        <button class="btn-main" onclick="authorize()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="userInterface" class="box hidden">
        <div class="timer-badge" id="timeLeft">Ù…ØªØ¨Ù‚ÙŠ: Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</div>
        <div class="res-display" id="resDisplay">Ù…Ø²Ø§Ù…Ù†Ø© (0/4)</div>
        <div class="grid" id="btnGrid"></div>
    </div>

    <div id="adminConsole" class="box hidden" style="border-color: var(--red);">
        <h2 style="color: var(--red);">Ù„ÙˆØ­Ø© Ø§Ù„ØªØµÙ†ÙŠØ¹</h2>
        <input type="text" id="keyName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ¯">
        <input type="number" id="keyDuration" placeholder="Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª">
        <button class="btn-main" style="background: var(--red); color: white;" onclick="createKey()">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</button>
    </div>

    <script>
        // --- Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ---
        const config = { databaseURL: "https://reko-predator-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(config);
        const db = firebase.database();

        // ØªÙˆÙ„ÙŠØ¯ Ø¨ØµÙ…Ø© ÙØ±ÙŠØ¯Ø© Ù„Ù„Ø¬Ù‡Ø§Ø² (User Agent + Screen Width)
        const deviceFingerprint = btoa(navigator.userAgent + window.screen.width);

        function authorize() {
            const key = document.getElementById('authKey').value;
            if(key === "REKO-MASTER-3000") {
                document.getElementById('loginGate').classList.add('hidden');
                document.getElementById('adminConsole').classList.remove('hidden');
                return;
            }

            db.ref('active_keys/' + key).once('value').then((snap) => {
                const data = snap.val();
                if(data) {
                    const now = new Date().getTime();
                    
                    // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª
                    if(now > data.expiresAt) {
                        alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ!");
                        return;
                    }

                    // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø² (Device Lock)
                    if(!data.deviceId) {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£ÙˆÙ„ØŒ Ù†Ø³Ø¬Ù„ Ø¨ØµÙ…Ø© Ø§Ù„Ø¬Ù‡Ø§Ø²
                        db.ref('active_keys/' + key).update({ deviceId: deviceFingerprint });
                        startApp(key, data.expiresAt);
                    } else if(data.deviceId === deviceFingerprint) {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ Ù†Ø³Ù…Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„
                        startApp(key, data.expiresAt);
                    } else {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¬Ù‡Ø§Ø²Ø§Ù‹ Ù…Ø®ØªÙ„ÙØ§Ù‹ØŒ Ù†Ø±ÙØ¶ Ø§Ù„Ø¯Ø®ÙˆÙ„
                        alert("âŒ Ø®Ø·Ø£: Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙØ¹Ù„ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø± ÙÙ‚Ø·!");
                    }
                } else {
                    alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");
                }
            });
        }

        function startApp(key, expiry) {
            document.getElementById('loginGate').classList.add('hidden');
            document.getElementById('userInterface').classList.remove('hidden');
            
            setInterval(() => {
                const diff = expiry - new Date().getTime();
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById('timeLeft').innerText = `Ù…ØªØ¨Ù‚ÙŠ: ${hours}Ø³Ø§Ø¹Ø© Ùˆ ${mins}Ø¯Ù‚ÙŠÙ‚Ø©`;
            }, 1000);

            loadEngine();
        }

        let history = [];
        function loadEngine() {
            const items = ["ðŸ¥", "ðŸŸ", "ðŸ‚", "ðŸ¤", "ðŸ…", "ðŸ¥•", "ðŸŒ¶ï¸", "ðŸŒ½"];
            const grid = document.getElementById('btnGrid');
            items.forEach(item => {
                let b = document.createElement('button');
                b.className = 'game-btn'; b.innerText = item;
                b.onclick = () => {
                    history.push(item); if(history.length > 4) history.shift();
                    const disp = document.getElementById('resDisplay');
                    if(history.length < 4) disp.innerText = `Ù…Ø²Ø§Ù…Ù†Ø©: ${history.length}/4`;
                    else {
                        const r = items.sort(() => .5 - Math.random()).slice(0,4);
                        disp.innerHTML = `ðŸŽ¯ ${r[0]} | ${r[1]} <br> ${r[2]} | ${r[3]}`;
                    }
                };
                grid.appendChild(b);
            });
        }

        function createKey() {
            const name = document.getElementById('keyName').value;
            const hours = document.getElementById('keyDuration').value;
            const expireAt = new Date().getTime() + (hours * 60 * 60 * 1000);
            db.ref('active_keys/' + name).set({ 
                expiresAt: expireAt,
                deviceId: null // Ù†ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„ÙŠØ£Ø®Ø°Ù‡ Ø£ÙˆÙ„ Ø¬Ù‡Ø§Ø² ÙŠØ¯Ø®Ù„
            }).then(() => { alert("ØªÙ… ØµÙ†Ø¹ ÙƒÙˆØ¯ Ù…Ø­Ù…ÙŠ Ø¨Ù†Ø¬Ø§Ø­!"); });
        }
    </script>
</body>
</html>
